\begin{lstlisting}[caption={Nominal State Space Controller Design Code.},label={lst:statespace_design}]
%% Nominal State Space Controller Design

w_c = 2*50*pi;
delta_c = 1/sqrt(2);
ts_5 = 0.27;        % tuned for real world test
M_p = 0.3;

delta = (log(1/M_p))/(sqrt(pi^2+log(1/M_p)*log(1/M_p)));
w_n = 3/(ts_5*delta);

phi = atan(sqrt(1 - delta^2)/delta);

lam_c1 = w_n*exp(1i*(-pi + phi));
lam_c2 = conj(lam_c1);
lam_c3 = w_n*exp(1i*(-pi + phi/2));
lam_c4 = conj(lam_c3);

A = [0, 0, 1, 0; 
     0, 0, 0, 1; 
     0, mld.k/(gbox.N^2*Jeq), -(Beq + mot.Kt*mot.Ke/(mot.R + sens.curr.Rs))/Jeq, 0;
     0, -(mld.k/mld.Jb + mld.k/(Jeq*gbox.N^2)), -mld.Bb/mld.Jb+(Beq + mot.Kt*mot.Ke/(mot.R + sens.curr.Rs))/Jeq, -mld.Bb/mld.Jb];

B = [0; 0; (mot.Kt*drv.dcgain)/(gbox.N*Jeq*(mot.R + sens.curr.Rs)); -(mot.Kt*drv.dcgain)/(gbox.N*Jeq*(mot.R + sens.curr.Rs))];

B_d = [0; 0; -1/(gbox.N^2*Jeq); 1/(gbox.N^2*Jeq)];

C=[1, 0, 0, 0];

D = 0;

F = [A, B; C, 0];
sol = [0, 0, 0, 0, 1].';

N = linsolve(F, sol);
N_x = N(1:4);
N_u = N(5);

K = acker(A,B,[lam_c1, lam_c2, lam_c3, lam_c4]);

t_0 = 0.2;
t_1 = 0.7;
\end{lstlisting}
\begin{lstlisting}[caption={Nominal State Space Controller with Integral Action Design Code.},label={lst:statespace_robust_design}]
%% Nominal State Space Controller with Integral Action Design

A_e = [0, C; [0; 0; 0; 0], A];
B_e = [0; B];
C_e = [0, C];
D_e = 0;

K_e = acker(A_e, B_e, [lam_c1, lam_c2, lam_c3, lam_c4, lam_c5]);
K_I = K_e(1);
K_new = K_e(2:5);

t_0 = 0.2;
t_1 = 0.7;
\end{lstlisting}
\pagebreak